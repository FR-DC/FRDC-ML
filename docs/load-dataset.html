<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-11T17:47:07.9933253"><meta name="build-number" content="${buildNumber}">       <title>load.dataset | Documentation</title><script id="virtual-toc-data" type="application/json">[{"id":"classes","level":0,"title":"Classes","anchor":"#classes"},{"id":"functions","level":0,"title":"Functions","anchor":"#functions"},{"id":"usage","level":0,"title":"Usage","anchor":"#usage"},{"id":"api","level":0,"title":"API","anchor":"#api"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="load.dataset | Documentation"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="Documentation Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/d/0.0.4/load-dataset.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="load.dataset | Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/d/0.0.4/load-dataset.html#webpage", "url": "/d/0.0.4/load-dataset.html", "name": "load.dataset | Documentation", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/d/#website", "url": "/d/", "name": "Documentation Help" }</script><!-- End Schema.org --></head>      <body data-id="load.dataset" data-main-title="load.dataset" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="API"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Documentation 0.0.4 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="load.dataset"   id="load.dataset.md">load.dataset</h1> <div class="micro-format" data-content="{&quot;microFormat&quot;:[&quot;\u003cp id\u003d\&quot;b28aa7ec_8535\&quot;\u003eLoad datasets from our GCS bucket.\u003c/p\u003e&quot;]}"></div> <aside class="prompt" data-type="warning" data-title="" id="b28aa7ec_8443"><p id="b28aa7ec_8444">You need to Set-Up <a href="getting-started.html#gcloud" id="b28aa7ec_8445" data-tooltip="Before starting development, take a look at our repository structure. This will help you understand where to put your code."  >Google Cloud</a> with the appropriate permissions to use this library.</p></aside><section class="chapter"><h2 id="classes" data-toc="classes"   >Classes</h2><dl id="b28aa7ec_8447" data-style="title-top"><dt id="b28aa7ec_8448" data-expandable="false">FRDCDataset</dt><dd><p>Uses GCS utils to download and load the dataset. It also implements useful helper functions to load FRDC-specific datasets, such as loading our images and labels.</p></dd><dt id="b28aa7ec_8449" data-expandable="false">GCSConfig</dt><dd><p>A configuration object that controls how downloads are done. See Functions below</p></dd></dl></section><section class="chapter"><h2 id="functions" data-toc="functions"   >Functions</h2><dl id="b28aa7ec_8450" data-style="title-top"><dt id="b28aa7ec_8451" data-expandable="false">download</dt><dd><p>Downloads a file from Google Cloud Storage. If the file already exists locally, and the hashes match, it will not download the file</p></dd><dt id="b28aa7ec_8452" data-expandable="false">list_gcs_datasets</dt><dd><p>Lists all datasets in the bucket as a DataFrame.</p></dd><dt id="b28aa7ec_8453" data-expandable="false">open_file</dt><dd><p>Opens a file from Google Cloud Storage. If the file already exists locally, and the hashes match, it will not download the file</p></dd><dt id="b28aa7ec_8454" data-expandable="false">open_image</dt><dd><p>Opens an image from Google Cloud Storage as a PIL Image. If the file already exists locally, and the hashes match, it will not download the file</p></dd></dl></section><section class="chapter"><h2 id="usage" data-toc="usage"   >Usage</h2><p id="b28aa7ec_8455">An example loading our Chestnut Nature Park dataset. We retrieve the</p><ul class="list _ul" id="b28aa7ec_8456"><li class="list__item" id="b28aa7ec_8457"><p>hyperspectral bands</p></li><li class="list__item" id="b28aa7ec_8458"><p>order of the bands</p></li><li class="list__item" id="b28aa7ec_8459"><p>bounding boxes</p></li><li class="list__item" id="b28aa7ec_8460"><p>labels</p></li></ul><div class="code-block" data-lang="python"         >
from frdc.load import FRDCDataset

ds = FRDCDataset(site='chestnut_nature_park',
                 date='20201218',
                 version=None)
ar, order = ds.get_ar_bands()
bounds, labels = ds.get_bounds_and_labels()
</div><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="custom-authentication-downloads" data-toc="custom-authentication-downloads"   >Custom Authentication &amp; Downloads</h3></div><div class="collapse__content"><p id="b28aa7ec_8462">If you need granular control over</p><ul class="list _ul" id="b28aa7ec_8463"><li class="list__item" id="b28aa7ec_8464"><p>where the files are downloaded</p></li><li class="list__item" id="b28aa7ec_8465"><p>the credentials used</p></li><li class="list__item" id="b28aa7ec_8466"><p>the project used</p></li><li class="list__item" id="b28aa7ec_8467"><p>the bucket used</p></li></ul><p id="b28aa7ec_8468">Then pass in a <code class="code" id="b28aa7ec_8469">GCSConfig</code> object to <code class="code" id="b28aa7ec_8470">FRDCDataset</code>.</p><div class="code-block" data-lang="python"         >
from frdc.load import FRDCDataset, GCSConfig

cfg = GCSConfig(credentials=...,
               local_dir=...,
               project_id=...,
               bucket_name=...,
               local_exists_ok=True)
ds = FRDCDataset(site='chestnut_nature_park',
                 date='20201218',
                 version=None, )
ar, order = ds.get_ar_bands(dl_config=cfg)
bounds, labels = ds.get_bounds_and_labels(dl_config=cfg)
</div><p id="b28aa7ec_8472">If you have a file not easily downloadable by <code class="code" id="b28aa7ec_8473">FRDCDataset</code>, use the <code class="code" id="b28aa7ec_8474">gcs</code> module utility functions</p><div class="code-block" data-lang="python"         >
from frdc.load import download

download(fp=&quot;path/to/gcs/file&quot;)
</div><aside class="prompt" data-type="tip" data-title="" id="b28aa7ec_8476"><p>This will automatically save the file to the local dataset root dir.</p></aside></div></div></section></section><section class="chapter"><h2 id="api" data-toc="api"   >API</h2><section class="chapter"><h3 id="frdcdataset" data-toc="frdcdataset"   >FRDCDataset</h3><dl id="b28aa7ec_8477" data-style="title-top"><dt id="b28aa7ec_8478" data-expandable="false">FRDCDataset(site, date, version, dl)</dt><dd><p><b id="b28aa7ec_8479">Initializes the dataset.</b></p><br><p> This doesn't immediately download the dataset, but only when you call the <code class="code" id="b28aa7ec_8481">get_*</code> functions. </p><br><p> The site, date, version must match the dataset path on GCS. For example if the dataset is at <code class="code" id="b28aa7ec_8483">gs://frdc-scan/my-site/20201218/90deg/map</code>, </p><ul class="list _ul" id="b28aa7ec_8484"><li class="list__item" id="b28aa7ec_8485"><p><code class="code" id="b28aa7ec_8486">site='my-site'</code></p></li><li class="list__item" id="b28aa7ec_8487"><p><code class="code" id="b28aa7ec_8488">date='20201218'</code></p></li><li class="list__item" id="b28aa7ec_8489"><p><code class="code" id="b28aa7ec_8490">version='90deg/map'</code></p></li></ul><p> If the dataset doesn't have a &quot;version&quot;, for example: <code class="code" id="b28aa7ec_8491">gs://frdc-scan/my-site/20201218</code>, then you can pass in <code class="code" id="b28aa7ec_8492">version=None</code>. </p><br><aside class="prompt" data-type="note" data-title="" id="b28aa7ec_8494"><p>If you don't want to search up GCS, you can use <code class="code" id="b28aa7ec_8495">gcs.utils</code> to list all datasets, and their versions with <code class="code" id="b28aa7ec_8496">list_gcs_datasets()</code></p></aside></dd><dt id="b28aa7ec_8497" data-expandable="false">get_ar_bands()</dt><dd><p><b id="b28aa7ec_8498">Gets the NDArray bands (H x W x C) and channel order as <code class="code" id="b28aa7ec_8499">tuple[np.ndarray, list[str]]</code>.</b></p><br><p> This downloads (if missing) and retrieves the stacked NDArray bands. This wraps around <code class="code" id="b28aa7ec_8501">get_ar_bands_as_dict()</code>, thus if you want more control over how the bands are loaded, use that instead.</p></dd><dt id="b28aa7ec_8502" data-expandable="false">get_ar_bands_as_dict()</dt><dd><p><b id="b28aa7ec_8503">Gets the NDArray bands (H x W) as a <code class="code" id="b28aa7ec_8504">dict[str, np.ndarray]</code>.</b></p><br><p> This downloads (if missing) and retrieves the individual NDArray bands as a dictionary. The keys are the band names, and the values are the NDArray bands.</p></dd><dt id="b28aa7ec_8506" data-expandable="false">get_bounds_and_labels()</dt><dd><p><b id="b28aa7ec_8507">Gets the bounding boxes and labels as <code class="code" id="b28aa7ec_8508">tuple[list[Rect], list[str]]</code>.</b></p><br><p> This downloads (if missing) and retrieves the bounding boxes and labels as a tuple. The first element is a list of bounding boxes, and the second element is a list of labels. </p><br><aside class="prompt" data-type="tip" data-title="" id="b28aa7ec_8511"><p>The bounding boxes are in the format of <code class="code" id="b28aa7ec_8512">Rect</code>, a <code class="code" id="b28aa7ec_8513">namedtuple</code> of x0, y0, x1, y1.</p></aside></dd></dl></section><section class="chapter"><h3 id="gcs" data-toc="gcs"   >gcs</h3><dl id="b28aa7ec_8514" data-style="title-top"><dt id="b28aa7ec_8515" data-expandable="false">list_gcs_datasets(anchor)</dt><dd><p><b id="b28aa7ec_8516">Lists all GCS datasets in the bucket as <code class="code" id="b28aa7ec_8517">DataFrame</code></b></p><br><p> This works by checking which folders have a specific file, which we call the <code class="code" id="b28aa7ec_8519">anchor</code>.</p></dd><dt id="b28aa7ec_8520" data-expandable="false">download(fp, config)</dt><dd><p><b id="b28aa7ec_8521">Downloads a file from GCS.</b></p><br><p> Takes in a path glob <code class="code" id="b28aa7ec_8523">fp</code>, a string containing wildcards, and downloads exactly 1 file. If it matches 0 or more than 1 file, it will raise an error. </p><br><p> It uses the configuration from <code class="code" id="b28aa7ec_8525">config</code>, which controls the behavior of how downloads are done. The default is usually fine. </p><br><p> The download will skip if the file exists and the hash matches.</p></dd><dt id="b28aa7ec_8527" data-expandable="false">open_file(fp, config)</dt><dd><p><b id="b28aa7ec_8528">Opens a file from GCS.</b></p><br><p> Wraps around <code class="code" id="b28aa7ec_8530">download()</code>, but returns a file handle instead.</p></dd><dt id="b28aa7ec_8531" data-expandable="false">open_image(fp, config)</dt><dd><p><b id="b28aa7ec_8532">Opens an image from GCS as a PIL Image.</b></p><br><p> Wraps around <code class="code" id="b28aa7ec_8534">download()</code>, but returns a PIL Image instead.</p></dd></dl></section></section><div class="last-modified"> Last modified: 11 December 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="model-test-chestnut-may-dec.html">Model Test Chestnut May-Dec</a>   <a class="navigation-links__next" href="preprocessing-scale.html">preprocessing.scale</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>