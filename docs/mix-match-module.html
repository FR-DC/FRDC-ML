<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-13T18:42:52.2245772"><meta name="build-number" content="${buildNumber}">       <title>MixMatch Module | Documentation</title><script id="virtual-toc-data" type="application/json">[{"id":"quick-recap","level":0,"title":"Quick Recap","anchor":"#quick-recap"},{"id":"mixmatch","level":0,"title":"MixMatch","anchor":"#mixmatch"},{"id":"design-choices","level":0,"title":"Design Choices","anchor":"#design-choices"},{"id":"references","level":0,"title":"References","anchor":"#references"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="MixMatch Module | Documentation"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="Documentation Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/d/0.0.7/mix-match-module.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="MixMatch Module | Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/d/0.0.7/mix-match-module.html#webpage", "url": "/d/0.0.7/mix-match-module.html", "name": "MixMatch Module | Documentation", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/d/#website", "url": "/d/", "name": "Documentation Help" }</script><!-- End Schema.org --></head>      <body data-id="mix-match-module" data-main-title="MixMatch Module" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="mix-match.md|MixMatch"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Documentation 0.0.7 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="mix-match-module"   id="mix-match-module.md">MixMatch Module</h1>  <p id="1c75350f_1412">See <code class="code" id="1c75350f_1413">frdc/train/mixmatch_module.py</code>.</p><section class="chapter"><h2 id="quick-recap" data-toc="quick-recap"   >Quick Recap</h2><p id="1c75350f_1414">We will go over the essential parts of the code here. Before that, we revise some of the concepts that are used in the code.</p><section class="chapter"><h3 id="abstract-methods" data-toc="abstract-methods"   >Abstract Methods</h3><p id="1c75350f_1415">In Python, we can define abstract methods using the <code class="code" id="1c75350f_1416">abc</code> module. Just like other OOP languages, abstract methods are methods that must be implemented by the child class.</p><p id="1c75350f_1417">For example:</p><div class="code-block" data-lang="python"         >
from abc import ABC, abstractmethod


class MyAbstractClass(ABC):
    @abstractmethod
    def my_abstract_method(self):
        pass


class MyChildClass(MyAbstractClass):
    def my_abstract_method(self):
        print(&quot;Hello World!&quot;)
</div></section><section class="chapter"><h3 id="nn-module-lightningmodule" data-toc="nn-module-lightningmodule"   >nn.Module &amp; LightningModule</h3><p id="1c75350f_1419">If you're unfamiliar with PyTorch, you should read the <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html" id="1c75350f_1420"   data-external="true" rel="noopener noreferrer" >nn.Module Documentation</a>.</p><p id="1c75350f_1421"><code class="code" id="1c75350f_1422">nn.Module</code> is the base class for all neural network modules in PyTorch. While <code class="code" id="1c75350f_1423">LightningModule</code> is a PyTorch Lightning class that extends <code class="code" id="1c75350f_1424">nn.Module</code>, providing it with additional functionality that reduces boilerplate code.</p><p id="1c75350f_1425">By implementing it as a <code class="code" id="1c75350f_1426">LightningModule</code>, we also enter the PyTorch Lightning ecosystem, which provides us with a lot of useful features such as logging, early stopping, and more.</p><section class="chapter"><h4 id="what-do-we-implement-in-a-module" data-toc="what-do-we-implement-in-a-module"   >What do we implement in a Module?</h4><p id="1c75350f_1427">One key component that <code class="code" id="1c75350f_1428">nn.Module</code> requires, is the model. So for example:</p><div class="code-block" data-lang="python"         >
class MyModule(nn.Module):
    def __init__(self):
        super().__init__()
        self.model = nn.Sequential(
            nn.Linear(28 * 28, 128),
            nn.ReLU(),
            nn.Linear(128, 10),
        )

    def forward(self, x):
        return self.model(x)
</div><p id="1c75350f_1430">PyTorch Lightning builds on top of it, requiring <code class="code" id="1c75350f_1431">training_step</code> and <code class="code" id="1c75350f_1432">validation_step</code>. Each &quot;step&quot; is a batch of data, and the model is trained on it. So for example:</p><div class="code-block" data-lang="python"         >
class MyModule(LightningModule):
    def __init__(self): ...

    def forward(self, x): ...

    def training_step(self, batch, batch_idx):
        x, y = batch
        y_hat = self(x)
        loss = F.cross_entropy(y_hat, y)
        return loss

    def validation_step(self, batch, batch_idx):
        x, y = batch
        y_hat = self(x)
        loss = F.cross_entropy(y_hat, y)
        return loss
</div><p id="1c75350f_1434">Usually, the training and validation steps are the same, but in some cases, such as MixMatch, they are different. In MixMatch, we not only use a different loss function for train, we also handle a batch differently. The PyTorch Lightning framework allows us to separate the two, and implement them separately.</p></section></section><section class="chapter"><h3 id="model-embedded-preprocessing-on-before-batch-transfer" data-toc="model-embedded-preprocessing-on-before-batch-transfer"   >Model Embedded Preprocessing on_before_batch_transfer</h3><p id="1c75350f_1435">In PyTorch Lightning, we can also inject a step before the batch is passed to the model. This is done by overriding the <code class="code" id="1c75350f_1436">on_before_batch_transfer</code> method.</p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 498.375 134"  xmlns="http://www.w3.org/2000/svg" width="498.375" id="mermaid"><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="10" viewBox="0 0 12 20" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M55.46875,59L59.635416666666664,59C63.802083333333336,59,72.13541666666667,59,80.46875,59C88.80208333333333,59,97.13541666666667,59,101.30208333333333,59L105.46875,59"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M257.4468005952381,42L269.94525049603175,37.833333333333336C282.44370039682536,33.666666666666664,307.4406001984127,25.333333333333332,325.394779265873,21.166666666666668C343.3489583333333,17,354.2604166666667,17,359.7161458333333,17L365.171875,17"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" id="L-B-D-0" d="M257.4468005952381,76L269.94525049603175,80.16666666666667C282.44370039682536,84.33333333333333,307.4406001984127,92.66666666666667,324.105716765873,96.83333333333333C340.7708333333333,101,349.1041666666667,101,353.2708333333333,101L357.4375,101"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(27.734375, 59)" id="flowchart-A-27186" class="node default default flowchart-label"><rect height="34" width="55.46875" y="-17" x="-27.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="40.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Batch</span></div></foreignObject></g></g><g transform="translate(206.453125, 59)" id="flowchart-B-27187" class="node default default flowchart-label"><rect height="34" width="201.96875" y="-17" x="-100.984375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-93.484375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="186.96875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">on_before_batch_transfer</span></div></foreignObject></g></g><g transform="translate(419.90625, 17)" id="flowchart-C-27189" class="node default default flowchart-label"><rect height="34" width="109.46875" y="-17" x="-54.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-47.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="94.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">training_step</span></div></foreignObject></g></g><g transform="translate(419.90625, 101)" id="flowchart-D-27191" class="node default default flowchart-label"><rect height="34" width="124.9375" y="-17" x="-62.46875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-54.96875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="109.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">validation_step</span></div></foreignObject></g></g></g></g></g></svg><aside class="prompt" data-type="tip" data-title="" id="1c75350f_1438"><p id="1c75350f_1439"><code class="code" id="1c75350f_1440">before</code> means it is done before the batch is transferred to the GPU</p></aside><p id="1c75350f_1441">This allows us to do preprocessing on the batch, such as scaling the data, encoding the labels, and more.</p></section><section class="chapter"><h3 id="custom-ema-update-on-after-backward" data-toc="custom-ema-update-on-after-backward"   >Custom EMA Update on_after_backward</h3><p id="1c75350f_1442">We also leverage another hook, called <code class="code" id="1c75350f_1443">on_after_backward</code>. This hook is called after the backward pass, and allows us to do custom operations. In our case, we use it to update the EMA model.</p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 588.28125 50"  xmlns="http://www.w3.org/2000/svg" width="588.28125" id="mermaid"><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="10" viewBox="0 0 12 20" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-C" id="L-A-C-0" d="M55.46875,17L59.635416666666664,17C63.802083333333336,17,72.13541666666667,17,80.46875,17C88.80208333333333,17,97.13541666666667,17,101.30208333333333,17L105.46875,17"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M214.9375,17L219.10416666666666,17C223.27083333333334,17,231.60416666666666,17,239.9375,17C248.27083333333334,17,256.6041666666667,17,260.7708333333333,17L264.9375,17"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M418.421875,17L422.5885416666667,17C426.7552083333333,17,435.0885416666667,17,443.421875,17C451.7552083333333,17,460.0885416666667,17,464.2552083333333,17L468.421875,17"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(27.734375, 17)" id="flowchart-A-27318" class="node default default flowchart-label"><rect height="34" width="55.46875" y="-17" x="-27.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="40.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Batch</span></div></foreignObject></g></g><g transform="translate(160.203125, 17)" id="flowchart-C-27319" class="node default default flowchart-label"><rect height="34" width="109.46875" y="-17" x="-54.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-47.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="94.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">training_step</span></div></foreignObject></g></g><g transform="translate(341.6796875, 17)" id="flowchart-D-27321" class="node default default flowchart-label"><rect height="34" width="153.484375" y="-17" x="-76.7421875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-69.2421875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="138.484375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">on_after_backward</span></div></foreignObject></g></g><g transform="translate(520.3515625, 17)" id="flowchart-E-27323" class="node default default flowchart-label"><rect height="34" width="103.859375" y="-17" x="-51.9296875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-44.4296875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="88.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">update_ema</span></div></foreignObject></g></g></g></g></g></svg></section></section><section class="chapter"><h2 id="mixmatch" data-toc="mixmatch"   >MixMatch</h2><p id="1c75350f_1445">We recommend having <code class="code" id="1c75350f_1446">tests/model_tests/chestnut_dec_may/train.py</code> open while reading this section. It implements a real-world example of MixMatch.</p><p id="1c75350f_1447">As a summary:</p><ol class="list _decimal" id="1c75350f_1448" type="1"><li class="list__item" id="1c75350f_1449"><p>We learned what is an abstract method, and how to implement it</p></li><li class="list__item" id="1c75350f_1450"><p>We implement the model in <code class="code" id="1c75350f_1451">LightningModule</code> much like we would in <code class="code" id="1c75350f_1452">nn.Module</code></p></li><li class="list__item" id="1c75350f_1453"><p>We implement <code class="code" id="1c75350f_1454">on_before_batch_transfer</code> to preprocess the batch</p></li><li class="list__item" id="1c75350f_1455"><p>Finally, we implement <code class="code" id="1c75350f_1456">on_after_backward</code> to update the EMA model</p></li></ol><p id="1c75350f_1457">With the above in mind, let's look at the MixMatch implementation.</p><dl id="1c75350f_1458" data-style="title-top"><dt id="1c75350f_1459" data-expandable="false">forward (abstract)</dt><dd><p id="1c75350f_1460">Forward pass of the model</p></dd><dt id="1c75350f_1461" data-expandable="false">ema_model (abstract)</dt><dd><p id="1c75350f_1462">The model that is used for EMA. We expect this property to be implemented by the child class.</p></dd><dt id="1c75350f_1463" data-expandable="false">update_ema (abstract)</dt><dd><p id="1c75350f_1464">The method to update the EMA model. We expect this method to be implemented by the child class.</p></dd><dt id="1c75350f_1465" data-expandable="false">loss_unl_scaler (static)</dt><dd><p id="1c75350f_1466">Takes in the current progress of the training, 0.0 to 1.0, where 0.0 is the start of the training, and 1.0 is the end. Then, returns the multiplier for the unlabeled loss.</p></dd><dt id="1c75350f_1467" data-expandable="false">loss_lbl (static)</dt><dd><p id="1c75350f_1468">Implements the loss for labeled data. Takes in the predicted labels and the ground truth labels, and returns the loss. This is cross entropy for MixMatch.</p></dd><dt id="1c75350f_1469" data-expandable="false">loss_unl (static)</dt><dd><p id="1c75350f_1470">Implements the loss for unlabeled data. Takes in the predicted labels and the ground truth labels, and returns the loss. This is MSE for MixMatch.</p></dd><dt id="1c75350f_1471" data-expandable="false">mixup</dt><dd><p id="1c75350f_1472">Takes in the data and the labels, the beta distribution parameter, and returns the mixed data and labels.</p></dd><dt id="1c75350f_1473" data-expandable="false">sharpen</dt><dd><p id="1c75350f_1474">Takes in the labels and temperature, and returns the sharpened labels.</p></dd><dt id="1c75350f_1475" data-expandable="false">guess_labels</dt><dd><p id="1c75350f_1476">Takes in the unlabeled data, and returns the guessed labels.</p></dd><dt id="1c75350f_1477" data-expandable="false">progress</dt><dd><p id="1c75350f_1478">The current progress of the training, 0.0 to 1.0, where 0.0 is the start of the training, and 1.0 is the end.</p></dd><dt id="1c75350f_1479" data-expandable="false">training_step</dt><dd><p id="1c75350f_1480">The training step runs through 1 batch of data, and returns the loss. Note that this is significantly different from validation step, as we handle the K-Augmented data differently.</p></dd><dt id="1c75350f_1481" data-expandable="false">test / validation_step</dt><dd><p id="1c75350f_1482">The test / validation step runs through 1 batch of data, and returns the loss.</p></dd><dt id="1c75350f_1483" data-expandable="false">predict_step</dt><dd><p id="1c75350f_1484">The predict step runs through 1 batch of data, and returns the actual decoded labels.</p></dd><dt id="1c75350f_1485" data-expandable="false">on_after_backward</dt><dd><p id="1c75350f_1486">The on_after_backward hook is called after the backward pass, and allows us to do custom operations. In our case, we use it to update the EMA model.</p></dd><dt id="1c75350f_1487" data-expandable="false">on_before_batch_transfer</dt><dd><p id="1c75350f_1488">The on_before_batch_transfer hook is called before the batch is transferred to the GPU. In our case, we use it to preprocess the batch.</p></dd></dl><p id="1c75350f_1489">A diagram of how these components interact with each other is shown below:</p><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 379.7109375 974"  xmlns="http://www.w3.org/2000/svg" width="379.7109375" id="mermaid"><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="10" viewBox="0 0 12 20" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M217.640625,34L217.640625,38.166666666666664C217.640625,42.333333333333336,217.640625,50.666666666666664,217.640625,59C217.640625,67.33333333333333,217.640625,75.66666666666667,217.640625,79.83333333333333L217.640625,84"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M183.80189732142856,118L175.5080915178571,122.16666666666667C167.2142857142857,126.33333333333333,150.62667410714286,134.66666666666666,142.33286830357142,143C134.0390625,151.33333333333334,134.0390625,159.66666666666666,134.0390625,163.83333333333334L134.0390625,168"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-F" id="L-C-F-0" d="M134.0390625,202L134.0390625,206.16666666666666C134.0390625,210.33333333333334,134.0390625,218.66666666666666,134.0390625,227C134.0390625,235.33333333333334,134.0390625,243.66666666666666,134.0390625,247.83333333333334L134.0390625,252"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G" id="L-F-G-0" d="M134.0390625,286L134.0390625,290.1666666666667C134.0390625,294.3333333333333,134.0390625,302.6666666666667,134.0390625,311C134.0390625,319.3333333333333,134.0390625,327.6666666666667,134.0390625,331.8333333333333L134.0390625,336"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M134.0390625,370L134.0390625,374.1666666666667C134.0390625,378.3333333333333,134.0390625,386.6666666666667,134.0390625,395C134.0390625,403.3333333333333,134.0390625,411.6666666666667,134.0390625,415.8333333333333L134.0390625,420"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-I" id="L-H-I-0" d="M104.62109375,454L97.41080729166667,458.1666666666667C90.20052083333333,462.3333333333333,75.77994791666667,470.6666666666667,68.56966145833333,479C61.359375,487.3333333333333,61.359375,495.6666666666667,61.359375,499.8333333333333L61.359375,504"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-J" id="L-I-J-0" d="M61.359375,538L61.359375,542.1666666666666C61.359375,546.3333333333334,61.359375,554.6666666666666,61.359375,563C61.359375,571.3333333333334,61.359375,579.6666666666666,61.359375,583.8333333333334L61.359375,588"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-L" id="L-J-L-0" d="M61.359375,622L61.359375,626.1666666666666C61.359375,630.3333333333334,61.359375,638.6666666666666,70.03385416666667,647.8461249059443C78.70833333333333,657.025583145222,96.05729166666667,667.0511662904439,104.73177083333333,672.063957863055L113.40625,677.0767494356659"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-k" id="L-H-k-0" d="M163.45703125,454L170.66731770833334,458.1666666666667C177.87760416666666,462.3333333333333,192.29817708333334,470.6666666666667,199.50846354166666,481.8333333333333C206.71875,493,206.71875,507,206.71875,521C206.71875,535,206.71875,549,206.71875,560.1666666666666C206.71875,571.3333333333334,206.71875,579.6666666666666,206.71875,583.8333333333334L206.71875,588"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-k LE-L" id="L-k-L-0" d="M206.71875,622L206.71875,626.1666666666666C206.71875,630.3333333333334,206.71875,638.6666666666666,198.04427083333334,647.8461249059443C189.36979166666666,657.025583145222,172.02083333333334,667.0511662904439,163.34635416666666,672.063957863055L154.671875,677.0767494356659"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-M" id="L-L-M-0" d="M134.0390625,706L134.0390625,710.1666666666666C134.0390625,714.3333333333334,134.0390625,722.6666666666666,134.0390625,731C134.0390625,739.3333333333334,134.0390625,747.6666666666666,134.0390625,751.8333333333334L134.0390625,756"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-M LE-D" id="L-M-D-0" d="M134.0390625,790L134.0390625,794.1666666666666C134.0390625,798.3333333333334,134.0390625,806.6666666666666,134.0390625,815C134.0390625,823.3333333333334,134.0390625,831.6666666666666,134.0390625,835.8333333333334L134.0390625,840"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M134.0390625,874L134.0390625,878.1666666666666C134.0390625,882.3333333333334,134.0390625,890.6666666666666,134.0390625,899C134.0390625,907.3333333333334,134.0390625,915.6666666666666,134.0390625,919.8333333333334L134.0390625,924"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-VC" id="L-B-VC-0" d="M251.47935267857144,118L259.7731584821429,122.16666666666667C268.0669642857143,126.33333333333333,284.65457589285717,134.66666666666666,292.9483816964286,143C301.2421875,151.33333333333334,301.2421875,159.66666666666666,301.2421875,163.83333333333334L301.2421875,168"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-VC LE-VL" id="L-VC-VL-0" d="M301.2421875,202L301.2421875,206.16666666666666C301.2421875,210.33333333333334,301.2421875,218.66666666666666,301.2421875,227C301.2421875,235.33333333333334,301.2421875,243.66666666666666,301.2421875,247.83333333333334L301.2421875,252"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(217.640625, 17)" id="flowchart-A-27390" class="node default default flowchart-label"><rect height="34" width="55.46875" y="-17" x="-27.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-20.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="40.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Batch</span></div></foreignObject></g></g><g transform="translate(217.640625, 101)" id="flowchart-B-27391" class="node default default flowchart-label"><rect height="34" width="201.96875" y="-17" x="-100.984375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-93.484375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="186.96875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">on_before_batch_transfer</span></div></foreignObject></g></g><g transform="translate(134.0390625, 185)" id="flowchart-C-27393" class="node default default flowchart-label"><rect height="34" width="109.46875" y="-17" x="-54.734375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-47.234375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="94.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">training_step</span></div></foreignObject></g></g><g transform="translate(134.0390625, 269)" id="flowchart-F-27394" class="node default default flowchart-label"><rect height="34" width="103.8125" y="-17" x="-51.90625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-44.40625, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="88.8125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">guess_labels</span></div></foreignObject></g></g><g transform="translate(134.0390625, 353)" id="flowchart-G-27395" class="node default default flowchart-label"><rect height="34" width="71.234375" y="-17" x="-35.6171875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-28.1171875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="56.234375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">sharpen</span></div></foreignObject></g></g><g transform="translate(134.0390625, 437)" id="flowchart-H-27396" class="node default default flowchart-label"><rect height="34" width="66.90625" y="-17" x="-33.453125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-25.953125, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="51.90625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">mix_up</span></div></foreignObject></g></g><g transform="translate(61.359375, 521)" id="flowchart-I-27397" class="node default default flowchart-label"><rect height="34" width="71.859375" y="-17" x="-35.9296875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-28.4296875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="56.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">loss_unl</span></div></foreignObject></g></g><g transform="translate(61.359375, 605)" id="flowchart-J-27398" class="node default default flowchart-label"><rect height="34" width="122.71875" y="-17" x="-61.359375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-53.859375, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="107.71875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">loss_unl_scaler</span></div></foreignObject></g></g><g transform="translate(134.0390625, 689)" id="flowchart-L-27399" class="node default default flowchart-label"><rect height="34" width="41.265625" y="-17" x="-20.6328125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-13.1328125, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="26.265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">loss</span></div></foreignObject></g></g><g transform="translate(206.71875, 605)" id="flowchart-k-27401" class="node default default flowchart-label"><rect height="34" width="68" y="-17" x="-34" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-26.5, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="53"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">loss_lbl</span></div></foreignObject></g></g><g transform="translate(134.0390625, 773)" id="flowchart-M-27403" class="node default default flowchart-label"><rect height="34" width="83.765625" y="-17" x="-41.8828125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-34.3828125, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="68.765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">backward</span></div></foreignObject></g></g><g transform="translate(134.0390625, 857)" id="flowchart-D-27405" class="node default default flowchart-label"><rect height="34" width="153.484375" y="-17" x="-76.7421875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-69.2421875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="138.484375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">on_after_backward</span></div></foreignObject></g></g><g transform="translate(134.0390625, 941)" id="flowchart-E-27407" class="node default default flowchart-label"><rect height="34" width="103.859375" y="-17" x="-51.9296875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-44.4296875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="88.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">update_ema</span></div></foreignObject></g></g><g transform="translate(301.2421875, 185)" id="flowchart-VC-27409" class="node default default flowchart-label"><rect height="34" width="124.9375" y="-17" x="-62.46875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-54.96875, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="109.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">validation_step</span></div></foreignObject></g></g><g transform="translate(301.2421875, 269)" id="flowchart-VL-27410" class="node default default flowchart-label"><rect height="34" width="41.265625" y="-17" x="-20.6328125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-13.1328125, -9.5)" style="" class="label"><rect></rect><foreignObject height="19" width="26.265625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">loss</span></div></foreignObject></g></g></g></g></g></svg><p id="1c75350f_1491">Finally, we show an example of how to use the MixMatch module:</p><div class="code-block" data-lang="python"         >
from sklearn.preprocessing import StandardScaler, OrdinalEncoder

from frdc.train.mixmatch_module import MixMatchModule

ss = StandardScaler()
ss.fit(X_train)
oe = OrdinalEncoder(
   handle_unknown=&quot;use_encoded_value&quot;,
   unknown_value=np.nan,
)
oe.fit(y_train)

MixMatchModule(
   x_scaler=ss,
   y_encoder=oe,
   n_classes=10,
   sharpen_temp=0.5,
   mix_beta_alpha=0.75,
)
</div><p id="1c75350f_1493">In particular, we need to supply some transformations for the preprocessing step. In this case, we use <code class="code" id="1c75350f_1494">StandardScaler</code> to scale the data, and <code class="code" id="1c75350f_1495">OrdinalEncoder</code> to encode the labels.</p><ol class="list _decimal" id="1c75350f_1496" type="1"><li class="list__item" id="1c75350f_1497"><p>It's best if standardization is done only on the training data, and not the validation data to better fit real-world scenarios.</p></li><li class="list__item" id="1c75350f_1498"><p>We use <code class="code" id="1c75350f_1499">OrdinalEncoder</code> as it handles unseen labels. So if a class doesn't show up in the training data, it will be encoded as <code class="code" id="1c75350f_1500">np.nan</code>, and will not participate in the loss calculation.</p></li></ol><aside class="prompt" data-type="warning" data-title="" id="1c75350f_1501"><p id="1c75350f_1502">Due to the nature of how we handle unseen labels, the performance can be an overestimate. This is because the model will not be penalized for misclassifying unseen labels.</p></aside></section><section class="chapter"><h2 id="design-choices" data-toc="design-choices"   >Design Choices</h2><section class="chapter"><h3 id="static-method-overriding" data-toc="static-method-overriding"   >Static Method Overriding</h3><p id="1c75350f_1503">We implement many functions as static, as we believe that a functional style reduces dependencies, thus making the code easier to test and debug.</p><p id="1c75350f_1504">Furthermore, it allows the subclasses to easily override the functions, to customize the behavior of the MixMatch module.</p><p id="1c75350f_1505">For example, the <code class="code" id="1c75350f_1506">loss_unl_scaler</code> function is static, thus, we can implement our own scaling function, and pass it to the MixMatch module.</p><div class="code-block" data-lang="python"         >
def my_loss_unl_scaler(progress: float) -&gt; float:
    return progress ** 2
    
class MyMixMatchModule(MixMatchModule):
    @staticmethod
    def loss_unl_scaler(progress: float) -&gt; float:
        return my_loss_unl_scaler(progress)
</div><p id="1c75350f_1508">If we had used a method instead, we would have to consider instance state, which would make it harder to override.</p></section><section class="chapter"><h3 id="why-not-use-dataclasses" data-toc="why-not-use-dataclasses"   >Why not use Dataclasses?</h3><p id="1c75350f_1509">One of the biggest caveats of <code class="code" id="1c75350f_1510">nn.Module</code> is that it requires <code class="code" id="1c75350f_1511">super().__init__()</code> to be called before anything is assigned. While <code class="code" id="1c75350f_1512">dataclass</code> can leverage <code class="code" id="1c75350f_1513">__post_init__</code> to do the same, we felt that this was too much of a hassle to save a few keystrokes. Thus, we opted to use <code class="code" id="1c75350f_1514">__init__</code> instead, while more verbose, it is more explicit.</p></section><section class="chapter"><h3 id="why-use-pytorch-lightning" data-toc="why-use-pytorch-lightning"   >Why use PyTorch Lightning?</h3><p id="1c75350f_1515">While we did hit some road blocks implementing SSL, due to its complex and unconventional nature, we felt that the benefits of using PyTorch Lightning outweighed the cons.</p><p id="1c75350f_1516"><code class="code" id="1c75350f_1517">on_before_batch_transfer</code> and <code class="code" id="1c75350f_1518">on_after_backward</code> are unconventional hooks, and we had to do some digging to find them. It can be argued that by just writing explicit code, we can avoid the need for these hooks, but the PyTorch ecosystem fixes many other issues, so we closed an eye on this.</p></section></section><section class="chapter"><h2 id="references" data-toc="references"   >References</h2><ul class="list _ul" id="1c75350f_1519"><li class="list__item" id="1c75350f_1520"><p><a href="https://github.com/YU1ut/MixMatch-pytorch/tree/master" id="1c75350f_1521"   data-external="true" rel="noopener noreferrer" >YU1ut's PyTorch Implementation</a></p></li><li class="list__item" id="1c75350f_1522"><p><a href="https://github.com/google-research/mixmatch" id="1c75350f_1523"   data-external="true" rel="noopener noreferrer" >Google Research's TensorFlow Implementation</a></p></li></ul></section><div class="last-modified"> Last modified: 13 December 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="mix-match.html">MixMatch</a>   <a class="navigation-links__next" href="custom-k-aug-dataloaders.html">Custom K-Aug Dataloaders</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>